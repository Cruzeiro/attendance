<table class='faculty'>
  <thead>
    <tr>
      <th rowspan='2' class='faculty_title'><%= resource %></th>
      <th class='grey'>прошедшая неделя</th>
      <th class='grey'>с начала семестра</th>
    </tr>
    <tr>
      <th class='faculty_aaflwb'><%= resource.average_attendance_from_last_week %></th>
      <th class='faculty_aafsb'><%= resource.average_attendance_from_semester_begin %></th>
    </tr>
  </thead>
  <tbody>
    <% resource.groups.group_by(&:course).sort.each do |course, groups| %>
      <tr class='course'>
        <td class='course_number'><%= "#{course} курс" %></td>
        <td class='course_aaflwb'>
          <%= "%.1f%" % (groups.count.zero? ? 0 : Group.where(:id => groups.map(&:id)).map(&:average_attendance_from_last_week).map(&:to_f).sum/groups.count) %>
        </td>
        <td class='course_aafsb'>
          <%= "%.1f%" % (groups.count.zero? ? 0 : Group.where(:id => groups.map(&:id)).map(&:average_attendance_from_semester_begin).map(&:to_f).sum/groups.count) %>
        </td>
      </tr>
      <% groups.each do |group| %>
        <tr class='group'>
          <td class='group_number'>
            <%= link_to group, [:manage, resource, group] %>
          </td>
          <td class='group_aaflwb'>
            <%= group.average_attendance_from_last_week %>
          </td>
          <td class='group_aafsb'>
            <%= group.average_attendance_from_semester_begin %>
          </td>
        </tr>
      <% end %>
    <% end %>
  </tbody>
</table>

